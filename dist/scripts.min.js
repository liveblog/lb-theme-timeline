!function(e){"use strict";function t(t,i,a,n,s,l,o,m,r,d){function c(){return y.pagesManager.retrieveUpdate().then(function(t){if(y.pagesManager.updateLatestDates(t._items),y.timeline)e.forEach(t._items,function(t){var i=!1;e.forEach(y.timeline.config.events,function(e){t._id===e._id&&(i=e.unique_id)}),i?"open"!==t.post_status||t.deleted?y.timeline.removeId(i):(y.timeline.removeId(i),y.timeline.add(h(t))):"open"===t.post_status&&y.timeline.add(h(t))});else{var i=[];e.forEach(t._items,function(e){"open"!==e.post_status||e.deleted||i.push(e)}),u(i)}})}function g(){a.get({},function(i){"closed"===i.blog_status&&(t.cancel(y.interval.posts),t.cancel(y.interval.blog)),e.extend(y.blog,i)})}function h(t){var i="";e.forEach(t.items,function(e){i+=""==i?e.text:"<br />"+e.text});var a={start_date:{month:moment(t.published_date).format("MM"),day:moment(t.published_date).format("D"),year:moment(t.published_date).format("YYYY"),hour:moment(t.published_date).format("H"),minute:moment(t.published_date).format("m")},_id:t._id,display_date:moment(t.published_date).format(n.settings.datetimeFormat),text:{text:i}};return a}function u(t){if(y.timeline)e.forEach(t,function(e){y.timeline.add(h(e))});else if(t.length){var i={events:[]};e.forEach(t,function(e){i.events.push(h(e))}),y.timeline=new d.TL.Timeline("liveblog-timeline",i),y.timelineOn=!0}}var p=n.settings.postsPerPage,f=100,v=n.settings.permalinkDelimiter||"?",b=n.settings.postOrder,w=(n.settings.loadNewPostsManually,"boolean"==typeof n.settings.loadNewStickyPostsManually?n.settings.loadNewStickyPostsManually:n.settings.loadNewPostsManually,3e3),y=this,k=new i(p,b,(!1)),P=new o(k,v),N=new i(f,b,(!0)),x=new o(N,v);e.extend(y,{templateDir:n.assets_root,blog:m(n.blog),loading:!0,timelineOn:!1,finished:!1,highlightsOnly:!1,settings:n.settings,newPosts:[],newStickyPosts:[],sortOptions:[{name:r("Editorial"),order:"editorial"},{name:r("Newest first"),order:"newest_first"},{name:r("Oldest first"),order:"oldest_first"}],orderBy:function(e){y.loading=!0,y.finished=!1,y.pagesManager.changeOrder(e).then(function(e){y.loading=!1,y.finished=e._meta.total<=e._meta.max_results*e._meta.page})},fetchNewPage:function(){return y.loading=!0,y.pagesManager.fetchNewPage().then(function(e){y.finished=e._meta.total<=e._meta.max_results*e._meta.page,u(e._items),y.stickyPagesManager.fetchNewPage().then(function(e){y.loading=!1,u(e._items)})})},permalinkScroll:function(){y.loading=!0,y.permalink.loadPost().then(function(e){s(e),y.loading=!1},function(){y.loading=!1})},isAllowedToLoadMore:function(){return!y.loading&&!y.finished},applyUpdates:function(){k.applyUpdates(y.newPosts,!0),y.newPosts=[],N.applyUpdates(y.newStickyPosts,!0),y.newStickyPosts=[]},toggleHighlighsOnly:function(){y.highlightsOnly=!y.highlightsOnly,y.loading=!0,y.finished=!1,N.changeHighlight(y.highlightsOnly),k.changeHighlight(y.highlightsOnly).then(function(e){y.loading=!1,y.finished=e._meta.total<=e._meta.max_results*e._meta.page}),y.highlightsOnly&&(N.hideSticky=!1)},pagesManager:k,permalink:P,stickyPagesManager:N,stickyPermalink:x}),y.fetchNewPage().then(function(){function e(e){"loadMore"===e.data&&i()}y.permalinkScroll(),"closed"!==y.blog.blog_status&&(y.interval={posts:t(c,w),blog:t(g,3*w)});var i=_.debounce(y.fetchNewPage,1e3);window.addEventListener("message",e,!1)})}t.$inject=["$interval","PagesManager","blogs","config","$anchorScroll","$timeout","Permalink","transformBlog","gettext","$window"],e.module("theme",["liveblog-embed","ngAnimate","infinite-scroll","gettext"]).run(["gettextCatalog","config",function(e,t){e.setCurrentLanguage(t.settings.language)}]).run(["$rootScope",function(t){e.element(document).on("click",function(i){t.$broadcast("documentClicked",e.element(i.target))})}]).controller("TimelineCtrl",t).directive("lbItem",["asset",function(e){return{restrict:"AE",scope:{ident:"=",item:"="},templateUrl:e.templateUrl("views/item.html")}}]).directive("lbAuthor",["asset",function(e){return{restrict:"AE",scope:{item:"=",timeline:"="},templateUrl:e.templateUrl("views/author.html")}}]).directive("lbPosts",["asset",function(e){return{restrict:"E",scope:{posts:"=",timeline:"="},templateUrl:e.templateUrl("views/posts.html")}}]),e.module("infinite-scroll").value("THROTTLE_MILLISECONDS",1e3)}(angular),angular.module("theme").run(["$templateCache",function(e){e.put("/themes_assets/classic/views/author.html",'<div class="lb-author" ng-if="timeline.settings.showAuthor"><div ng-if="timeline.settings.showAuthor && timeline.settings.showAuthorAvatar" ng-class="{\'lb-author__avatar\': (item.item_type !== \'comment\'),\n                       \'lb-author__comment\': (item.item_type === \'comment\')}"><img ng-src="{{ item.original_creator.picture_url }}"></div><div class="lb-author__date" ng-bind="item.displayDate | prettifyIsoDate"></div><div ng-if="!timeline.settings.authorNameLinksToEmail || item.item_type === \'comment\'" class="lb-author__name" ng-bind="item.original_creator[item.item_type === \'comment\'? \'display_name\': timeline.settings.authorNameFormat]"></div><div ng-if="timeline.settings.authorNameLinksToEmail && item.item_type !== \'comment\'" class="lb-author__name"><a href="mailto:{{post.mainItem.original_creator.email}}" ng-bind="item.original_creator[timeline.settings.authorNameFormat]"></a></div></div>'),e.put("/themes_assets/classic/views/comments.html",'<div class="modal-backdrop ng-cloak" ng-show="modal"></div><div class="modal ng-cloak" ng-show="modal"><div class="modal-dialog"><div ng-show="notify" class="notify"><div class="content"><div class="modal-header"><h3 translate>Your comment was sent for approval.</h3></div></div></div><div ng-show="form"><form name="comment" novalidate ng-submit="send();"><div class="content"><div class="modal-header"><h2 translate>Post a comment</h2></div><div class="modal-body"><fieldset><div class="field"><label for="commenter" translate>Name *</label><input name="commenter" ng-model="commenter"><div role="alert"><span class="error" ng-show="commenter.length < 3" translate>Please fill in your Name.</span> <span class="error" ng-show="commenter.length >30" translate>Name should be maximum 30 characters in length.</span></div></div><div class="field"><label for="content" translate>Comment *</label><textarea name="content" ng-model="content"></textarea><div role="alert"><span class="error" ng-show="content.length < 3" translate>Please fill in your Comment.</span> <span class="error" ng-show="content.length > 300" translate>Comment should be maximum 300 characters in length.</span></div></div></fieldset></div><div class="modal-footer"><button class="btn" ng-click="comment=false"><span translate>Cancel</span></button> <button type="submit" class="btn btn-primary"><span translate>Send</span></button></div></div></form></div></div></div>'),e.put("/themes_assets/classic/views/dropdown.html",'<div class="dropdown-container" ng-class="{ \'show\': listVisible }"><div class="dropdown-display" ng-click="show();" ng-class="{ \'clicked\': listVisible }"><span ng-if="!isPlaceholder">{{display | translate}}</span> <span class="placeholder" ng-if="isPlaceholder">{{placeholder}}</span> <i class="fa fa-angle-down"></i></div><div class="dropdown-list"><div><div ng-repeat="item in list" ng-click="select(item)" ng-class="{ \'selected\': isSelected(item) }"><span>{{item.name | translate}}</span> <i class="fa fa-check"></i></div></div></div></div>'),e.put("/themes_assets/classic/views/generic-embed.html",'<div ng-if="item.meta.html" class="item--embed" lb-bind-html html-content="{{item.meta.html}}"></div><article class="item--embed"><a ng-href="{{ item.meta.url }}" ng-if="!item.meta.html && item.meta.thumbnail_url" target="_blank" ng-class="{ \'item--embed__illustration\': item.meta.description, \'item--embed__only-illustration\': !item.meta.description}"><img ng-src="{{ item.meta.thumbnail_url }}"></a><div class="item--embed__title" ng-if="item.meta.title"><a ng-href="{{ item.meta.url }}" target="_blank" ng-bind="item.meta.title"></a></div><div class="item--embed__description" ng-if="item.meta.description" ng-bind="item.meta.description"></div><div class="item--embed__credit" ng-if="item.meta.credit" ng-bind="item.meta.credit"></div></article>'),e.put("/themes_assets/classic/views/item.html",'<div ng-switch="item.item_type" ng-class="{\'lb-item\': ident}"><div ng-switch-when="embed"><div ng-switch="item.meta.provider_name"><div ng-switch-when="Twitter"><lb-twitter-card lb-twitter-content="{{ item.meta.html }}"></lb-twitter-card></div><div ng-switch-default lb-generic-embed lb-fluid-iframe item="item"></div></div></div><div ng-switch-when="image"><figure><img ng-src="{{ item.picture_url }}" srcset="{{ item.picture_srcset }}" alt="{{ item.meta.caption }}"><figcaption translate>{{ item.meta.caption }} credit: {{ item.meta.credit }}</figcaption></figure></div><article ng-switch-default lb-bind-html html-content="{{ item.text | outboundAnchors }}"></article></div>'),e.put("/themes_assets/classic/views/posts.html",'<article ng-repeat="post in posts() track by post._id" class="lb-post list-group-item ng-cloak" ng-class="{\'show-author-avatar\': timeline.settings.showAuthor && timeline.settings.showAuthorAvatar,\n                    \'lb-post-permalink-selected\': post._id === timeline.permalink._id}"><lb-author item="post.mainItem" timeline="timeline"></lb-author><div class="lb-post-highlighted" ng-if="post.highlight"><i class="fa fa-star fa-2"></i></div><div class="lb-post-permalink"><a href="{{ timeline.permalink.get(post._id) }}" id="{{ post._id }}" target="_blank"><i class="fa fa-link fa-2"></i></a></div><div ng-repeat="item in post.items track by item._id" class="lb-item"><div ng-if="post.fullDetails && !$first" class="list-group-item"><div class="lb-timeline__header"><lb-author item="item" timeline="timeline"></lb-author><lb-item item="item" ident="true"></lb-item></div></div><div ng-if="!post.fullDetails || $first"><lb-item item="item"></lb-item></div></div><div class="lb-updated-date ng-cloak" ng-show="post.showUpdate" translate>Updated {{post.content_updated_date | prettifyIsoDate}}</div></article>')}]);